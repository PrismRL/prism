<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<template id="tmpl_gotoTop"><div id="gotoTop">
  <button>Back to top</button>
</div></template>
    <title>Getting started &#8212; Prism  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=266695fe" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a1f6949c" />
    <link rel="stylesheet" type="text/css" href="../_static/lua.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/terminal.css?v=47602536" />
    <link rel="stylesheet" type="text/css" href="../_static/goto-top/style.css?v=c152bd81" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/goto-top/main.js?v=69fc67a6"></script>
    <link rel="icon" href="../_static/prism.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Taking flight" href="part2.html" />
    <link rel="prev" title="Inventory" href="../how-tos/inventory.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h1>
<p>In this tutorial, we’ll start with a project template and create an enemy that follows
the player. And we’ll add the ability to kick them.</p>
<figure  class="sphinx-contrib-video-container align-center"><video controls="True" preload="auto"><source src="../_images/part1.mp4" type="video/mp4"></video><figcaption class="align-center"><p style="text-align: left; display:inline-block"><span class="caption-text">Kicking a kobold</span></p></figcaption></figure><p>The following sections will expand this into a complete game.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>To begin, download and install LÖVE. Prism technically supports LÖVE version 12.0, which is still
in pre-release but very stable.</p>
<p>Latest downloads, as of April 2025:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/love2d/love/actions/runs/14422931049/artifacts/2933455705">Windows</a></p></li>
<li><p><a class="reference external" href="https://github.com/love2d/love/actions/runs/14422931049/artifacts/2933455904">Linux AppImage</a></p></li>
<li><p><a class="reference external" href="https://github.com/love2d/love/actions/runs/14422931049/artifacts/2933456500">macOS</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prism makes heavy use of Lua type annotations to improve autocomplete, so we recommend
installing the <a class="reference external" href="https://luals.github.io/">Lua language server</a> for your editor.</p>
</div>
<p>Next, clone the template project:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/PrismRL/prism-template.git
</pre></div>
</div>
<p>You can start the game by running <code class="docutils literal notranslate"><span class="pre">love</span> <span class="pre">.</span></code> in the terminal from the root directory,
or dragging the root folder onto the LÖVE executable.</p>
<p>Upon launching, you should see an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol on the screen. You can
move this character using the following default keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">WASD</span></code> for movement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QEZC</span></code> for diagonal movement</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="creating-an-enemy">
<h2>Creating an enemy<a class="headerlink" href="#creating-an-enemy" title="Link to this heading">¶</a></h2>
<p>To make the game more engaging, let’s introduce an enemy: the
<strong>Kobold</strong>.</p>
<ol class="arabic simple">
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">/modules/MyGame/actors/</span></code> directory.</p></li>
<li><p>Create a new file named <code class="docutils literal notranslate"><span class="pre">kobold.lua</span></code>.</p></li>
<li><p>Add the following code to define the Kobold actor:</p></li>
</ol>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">registerActor</span><span class="p">(</span><span class="s2">&quot;Kobold&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">Actor</span><span class="p">.</span><span class="n">fromComponents</span> <span class="p">{</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Position</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">RED</span><span class="p">),</span>
   <span class="p">}</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s run the game again, and press <code class="docutils literal notranslate"><span class="pre">~</span></code>. This opens Geometer, the editor.
Click on the k on the right hand side and use the pen tool to draw a
kobold in. Press the green button to resume the game.</p>
<p>You might notice that you can walk right through the kobold. We fix that by giving it a
<a class="reference internal" href="../reference/prism/core/components/collider.html#lua-Collider" title="Collider"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Collider</span></code></a>:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Collider</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="../how-tos/collision.html"><span class="doc">Collision</span></a> for more information on the collision system.</p>
</div>
<p>If we restart the game and spawn in another kobold, we shouldn’t be able to walk
through kobolds anymore. We’re also going to give the kobold a few more core components: a
<a class="reference internal" href="../reference/prism/core/components/senses.html#lua-Senses" title="Senses"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Senses</span></code></a>, <code class="docutils literal notranslate"><span class="pre">SightComponent</span></code>, and <code class="docutils literal notranslate"><span class="pre">MoverComponent</span></code>, so it can see and move:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Senses</span><span class="p">(),</span>
<span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Sight</span><span class="p">{</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">fov</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">},</span>
<span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Mover</span><span class="p">{</span> <span class="s2">&quot;walk&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="the-kobold-controller">
<h2>The kobold controller<a class="headerlink" href="#the-kobold-controller" title="Link to this heading">¶</a></h2>
<p>Now that the kobold exists in the world, you might notice something—it’s
not moving! To give it behavior, we need to implement a <a class="reference internal" href="../reference/prism/core/components/controller.html#lua-Controller" title="Controller"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Controller</span></code></a>.</p>
<p>A <a class="reference internal" href="../reference/prism/core/components/controller.html#lua-Controller" title="Controller"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Controller</span></code></a> (or one of its derivatives) defines the <a class="reference internal" href="../reference/prism/core/components/controller.html#lua-Controller.act" title="Controller.act"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Controller:act()</span></code></a>
function, which takes the <a class="reference internal" href="../reference/prism/core/level.html#lua-Level" title="Level"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Level</span></code></a> and the <a class="reference internal" href="../reference/prism/core/actor.html#lua-Actor" title="Actor"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Actor</span></code></a> as arguments and
returns a valid action.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The <code class="docutils literal notranslate"><span class="pre">act</span></code> function <strong>should not modify the level directly</strong>–it should only use it to validate actions.</p>
</div>
<ol class="arabic simple">
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">modules/MyGame/components/</span></code>.</p></li>
<li><p>Create a new file named <code class="docutils literal notranslate"><span class="pre">koboldcontroller.lua</span></code>.</p></li>
<li><p>Add the following code:</p></li>
</ol>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">--- @class KoboldController : Controller</span>
<span class="c1">--- @overload fun(): KoboldController</span>
<span class="kd">local</span> <span class="n">KoboldController</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Controller</span><span class="p">:</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;KoboldController&quot;</span><span class="p">)</span>
<span class="n">KoboldController</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;KoboldController&quot;</span>

<span class="kr">function</span> <span class="nc">KoboldController</span><span class="p">:</span><span class="nf">act</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">destination</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="o">+</span> <span class="n">prism</span><span class="p">.</span><span class="n">Vector2</span><span class="p">.</span><span class="n">RIGHT</span>
   <span class="kd">local</span> <span class="n">move</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Move</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
   <span class="kr">if</span> <span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">move</span><span class="p">)</span> <span class="kr">then</span>
      <span class="kr">return</span> <span class="n">move</span>
   <span class="kr">end</span>

   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">KoboldController</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Always provide a default action to take in a controller.</p>
</div>
<p>Back in <code class="docutils literal notranslate"><span class="pre">kobold.lua</span></code>, give it our new controller component:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">KoboldController</span><span class="p">()</span>
</pre></div>
</div>
<p>Our kobold should move right until they hit a wall now, but this
behaviour doesn’t make for a great game. Let’s make them follow the player around.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Complete kobold.lua</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text"><a class="reference external" href="https://github.com/PrismRL/Kicking-Kobolds/blob/part1/modules/MyGame/actors/kobold.lua">Source</a></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">registerActor</span><span class="p">(</span><span class="s2">&quot;Kobold&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">Actor</span><span class="p">.</span><span class="n">fromComponents</span> <span class="p">{</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;Kobold&quot;</span><span class="p">),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Position</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Collider</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">RED</span><span class="p">),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Senses</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Sight</span><span class="p">{</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">fov</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Mover</span><span class="p">{</span> <span class="s2">&quot;walk&quot;</span> <span class="p">},</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">KoboldController</span><span class="p">()</span>
   <span class="p">}</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details></section>
<section id="pathfinding">
<h2>Pathfinding<a class="headerlink" href="#pathfinding" title="Link to this heading">¶</a></h2>
<p>To make our kobold follow the player, we need to do a few things:</p>
<ol class="arabic simple">
<li><p>See if the player is within range of the kobold.</p></li>
<li><p>Find a valid path to the player.</p></li>
<li><p>Move the kobold along that path.</p></li>
</ol>
<p>We can find the player by grabbing the <a class="reference internal" href="../reference/prism/core/components/senses.html#lua-Senses" title="Senses"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Senses</span></code></a> from the kobold and
seeing if it contains the player. We should also ensure the kobold has the component in the first place.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">senses</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Senses</span><span class="p">)</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">senses</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span> <span class="c1">-- we can&#39;t see!</span>

<span class="kd">local</span> <span class="n">player</span> <span class="o">=</span> <span class="n">senses</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">PlayerController</span><span class="p">):</span><span class="n">first</span><span class="p">()</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">player</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="../how-tos/query.html"><span class="doc">Queries</span></a> for more information on querying.</p>
</div>
<p>We can get a path to the player by using the <a class="reference internal" href="../reference/prism/core/level.html#lua-Level.findPath" title="Level.findPath"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Level:findPath()</span></code></a> method, passing the
positions and the kobold’s collision mask.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">mover</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Mover</span><span class="p">)</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">mover</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span> <span class="c1">-- we can&#39;t move!</span>

<span class="kd">local</span> <span class="n">path</span> <span class="o">=</span> <span class="n">level</span><span class="p">:</span><span class="n">findPath</span><span class="p">(</span><span class="n">actor</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">actor</span><span class="p">,</span> <span class="n">mover</span><span class="p">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we check if there’s a path and move the kobold along it, using <a class="reference internal" href="../reference/prism/algorithms/astar/path.html#lua-Path.pop" title="Path.pop"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Path:pop()</span></code></a> to get the first
position.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">path</span> <span class="kr">then</span>
   <span class="kd">local</span> <span class="n">move</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Move</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="n">pop</span><span class="p">())</span>
   <span class="kr">if</span> <span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">move</span><span class="p">)</span> <span class="kr">then</span>
      <span class="kr">return</span> <span class="n">move</span>
   <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Jump back into the game and you should find kobolds chasing after you.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Complete koboldcontroller.lua</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text"><a class="reference external" href="https://github.com/PrismRL/Kicking-Kobolds/blob/part1/modules/MyGame/components/koboldcontroller.lua">Source</a></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">--- @class KoboldController : Controller</span>
<span class="c1">--- @overload fun(): KoboldController</span>
<span class="kd">local</span> <span class="n">KoboldController</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Controller</span><span class="p">:</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;KoboldController&quot;</span><span class="p">)</span>
<span class="n">KoboldController</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;KoboldController&quot;</span>

<span class="kr">function</span> <span class="nc">KoboldController</span><span class="p">:</span><span class="nf">act</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">senses</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Senses</span><span class="p">)</span>
   <span class="kr">if</span> <span class="ow">not</span> <span class="n">senses</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span> <span class="c1">-- we can&#39;t see!</span>
   <span class="kd">local</span> <span class="n">player</span> <span class="o">=</span> <span class="n">senses</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">PlayerController</span><span class="p">):</span><span class="n">first</span><span class="p">()</span>
   <span class="kr">if</span> <span class="ow">not</span> <span class="n">player</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span>
   <span class="kd">local</span> <span class="n">mover</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Mover</span><span class="p">)</span>
   <span class="kr">if</span> <span class="ow">not</span> <span class="n">mover</span> <span class="kr">then</span> <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">()</span> <span class="kr">end</span>

   <span class="kd">local</span> <span class="n">path</span> <span class="o">=</span> <span class="n">level</span><span class="p">:</span><span class="n">findPath</span><span class="p">(</span><span class="n">actor</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">player</span><span class="p">:</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">actor</span><span class="p">,</span> <span class="n">mover</span><span class="p">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

   <span class="kr">if</span> <span class="n">path</span> <span class="kr">then</span>
      <span class="kd">local</span> <span class="n">move</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Move</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="n">pop</span><span class="p">())</span>
      <span class="kr">if</span> <span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">move</span><span class="p">)</span> <span class="kr">then</span>
         <span class="kr">return</span> <span class="n">move</span>
      <span class="kr">end</span>
   <span class="kr">end</span>

   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">KoboldController</span>
</pre></div>
</div>
</div>
</details></section>
<section id="kicking-kobolds">
<h2>Kicking kobolds<a class="headerlink" href="#kicking-kobolds" title="Link to this heading">¶</a></h2>
<p>In this section we’ll give you something to do to these kobolds: kick them!
We’ll need to create our first action. Head over to <code class="docutils literal notranslate"><span class="pre">/modules/MyGame/actions</span></code> and add kick.lua.</p>
<p>Let’s first create a target for our kick. Put this at the top of
kick.lua:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">KickTarget</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Target</span><span class="p">()</span>
   <span class="p">:</span><span class="n">with</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Collider</span><span class="p">)</span>
   <span class="p">:</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="p">:</span><span class="n">sensed</span><span class="p">()</span>
</pre></div>
</div>
<p>With this target we’re saying you can only kick actors at range one with a collider
component. Then we can define the kick action, including our target. We will also require
that any actor trying to perform the kick action have a controller.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">---@class KickAction : Action</span>
<span class="kd">local</span> <span class="n">Kick</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Action</span><span class="p">:</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;KickAction&quot;</span><span class="p">)</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Kick&quot;</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">{</span> <span class="n">KickTarget</span> <span class="p">}</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">requiredComponents</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Controller</span>
<span class="p">}</span>

<span class="kr">return</span> <span class="n">Kick</span>
</pre></div>
</div>
<p>For the logic, we’ll define methods that validate and perform the kick. We don’t have any
special conditions for kicking, so from <a class="reference internal" href="../reference/prism/core/action.html#lua-Action.canPerform" title="Action.canPerform"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Action:canPerform()</span></code></a> we’ll just return true.
For the kick itself, we get the direction from the player to the target (kobold), and check passability
for three tiles in the direction before finally moving them. We also give the kobold flying movement by
checking passability with a custom collision mask.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">Kick</span><span class="p">:</span><span class="nf">canPerform</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
   <span class="kr">return</span> <span class="kc">true</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Collision</span><span class="p">.</span><span class="n">createBitmaskFromMovetypes</span><span class="p">{</span> <span class="s2">&quot;fly&quot;</span> <span class="p">}</span>

<span class="c1">--- @param level Level</span>
<span class="c1">--- @param kicked Actor</span>
<span class="kr">function</span> <span class="nc">Kick</span><span class="p">:</span><span class="nf">perform</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">kicked</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">kicked</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

   <span class="kr">for</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="kr">do</span>
      <span class="n">nextpos</span> <span class="o">=</span> <span class="n">kicked</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="o">+</span> <span class="n">direction</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span><span class="n">getCellPassable</span><span class="p">(</span><span class="n">nextpos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">nextpos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">break</span> <span class="kr">end</span>
      <span class="kr">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span><span class="n">hasActor</span><span class="p">(</span><span class="n">kicked</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">break</span> <span class="kr">end</span>

      <span class="n">level</span><span class="p">:</span><span class="n">moveActor</span><span class="p">(</span><span class="n">kicked</span><span class="p">,</span> <span class="n">nextpos</span><span class="p">)</span>
   <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Complete kick.lua</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text"><a class="reference external" href="https://github.com/PrismRL/Kicking-Kobolds/blob/part1/modules/MyGame/actions/kick.lua">Source</a></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">KickTarget</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Target</span><span class="p">()</span>
   <span class="p">:</span><span class="n">with</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Collider</span><span class="p">)</span>
   <span class="p">:</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="p">:</span><span class="n">sensed</span><span class="p">()</span>

<span class="c1">---@class KickAction : Action</span>
<span class="kd">local</span> <span class="n">Kick</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Action</span><span class="p">:</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;KickAction&quot;</span><span class="p">)</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Kick&quot;</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">{</span> <span class="n">KickTarget</span> <span class="p">}</span>
<span class="n">Kick</span><span class="p">.</span><span class="n">requiredComponents</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Controller</span>
<span class="p">}</span>

<span class="kr">function</span> <span class="nc">Kick</span><span class="p">:</span><span class="nf">canPerform</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
   <span class="kr">return</span> <span class="kc">true</span>
<span class="kr">end</span>

<span class="c1">--- @param level Level</span>
<span class="c1">--- @param kicked Actor</span>
<span class="kr">function</span> <span class="nc">Kick</span><span class="p">:</span><span class="nf">perform</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">kicked</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">kicked</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">:</span><span class="n">getPosition</span><span class="p">())</span>

   <span class="kd">local</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Collision</span><span class="p">.</span><span class="n">createBitmaskFromMovetypes</span><span class="p">{</span> <span class="s2">&quot;fly&quot;</span> <span class="p">}</span>

   <span class="kr">for</span> <span class="n">_</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">nextpos</span> <span class="o">=</span> <span class="n">kicked</span><span class="p">:</span><span class="n">getPosition</span><span class="p">()</span> <span class="o">+</span> <span class="n">direction</span>

      <span class="kr">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span><span class="n">getCellPassable</span><span class="p">(</span><span class="n">nextpos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">nextpos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">break</span> <span class="kr">end</span>
      <span class="kr">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span><span class="n">hasActor</span><span class="p">(</span><span class="n">kicked</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">break</span> <span class="kr">end</span>

      <span class="n">level</span><span class="p">:</span><span class="n">moveActor</span><span class="p">(</span><span class="n">kicked</span><span class="p">,</span> <span class="n">nextpos</span><span class="p">)</span>
   <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">Kick</span>
</pre></div>
</div>
</div>
</details></section>
<section id="kicking-kobolds-for-real-this-time">
<h2>Kicking kobolds, for real this time<a class="headerlink" href="#kicking-kobolds-for-real-this-time" title="Link to this heading">¶</a></h2>
<p>We’ve added the kick action, but we don’t use it anywhere. Let’s fix that by performing the kick
when we bump into a kobold. Head over to <code class="docutils literal notranslate"><span class="pre">gamestates/MyGamelevelstate.lua</span></code> and find where the move action
is called. If the player doesn’t move, we want to check if there’s a valid actor to kick in front of us,
and then perform the kick action on them:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">move</span><span class="p">)</span> <span class="kr">then</span>
<span class="p">...</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span><span class="n">query</span><span class="p">()</span> <span class="c1">-- grab a query object</span>
   <span class="p">:</span><span class="n">at</span><span class="p">(</span><span class="n">destination</span><span class="p">:</span><span class="n">decompose</span><span class="p">())</span> <span class="c1">-- restrict the query to the destination</span>
   <span class="p">:</span><span class="n">first</span><span class="p">()</span> <span class="c1">-- grab one of the kickable things, or nil</span>

<span class="kd">local</span> <span class="n">kick</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Kick</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="kr">if</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">kick</span><span class="p">)</span> <span class="kr">then</span>
   <span class="n">decision</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">kick</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../reference/prism/core/level.html#lua-Level.canPerform" title="Level.canPerform"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Level:canPerform()</span></code></a> will validate all targets in the action.</p>
</div>
</section>
<section id="that-s-a-wrap">
<h2>That’s a wrap<a class="headerlink" href="#that-s-a-wrap" title="Link to this heading">¶</a></h2>
<p>That’s all for part one. In conclusion, we’ve accomplished the following:</p>
<ol class="arabic simple">
<li><p>Added a kobold enemy with basic pathfinding.</p></li>
<li><p>Implemented a kick action to shove kobolds around.</p></li>
<li><p>Integrated the kick by performing it when bumping into a valid target.</p></li>
</ol>
<p>You can find the code for this part at <a class="reference external" href="https://github.com/prismrl/prism-tutorial">https://github.com/prismrl/prism-tutorial</a> on the <code class="docutils literal notranslate"><span class="pre">part1</span></code> branch. In the
<a class="reference internal" href="part2.html"><span class="doc">next section</span></a>, we’ll do some work with components and systems to flesh out the combat system.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/prism.png" alt="Logo" />
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=prismrl&repo=prism&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<!--
Taken from the sphinx library theme: https://vsalvino.github.io/sphinx-library/.

MIT License

Copyright (c) 2020 Vince Salvino and contributors.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<script>
  function toggleMode(theme) {
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("sphinx-terminal-mode", theme);
  }
  var theme = localStorage.getItem("sphinx-terminal-mode");
  if(theme !== null)
    toggleMode(theme);
</script>
<h3>Reading Mode</h3>

<div class="btn-group">
<button class="btn btn-default" type="button" onclick="toggleMode('light');">Light</button>
<button class="btn btn-default" type="button" onclick="toggleMode('sepia');">Sepia</button>
<button class="btn btn-default" type="button" onclick="toggleMode('dark');">Dark</button>
</div>

<noscript>
  <div>
    JavaScript is required to toggle reading modes.
  </div>
</noscript>
<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../architecture-primer.html">Prism’s Architecture: A Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-tos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/object-registration.html">Object registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/query.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/collision.html">Collision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/inventory.html">Inventory</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Making a roguelike</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-enemy">Creating an enemy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-kobold-controller">The kobold controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pathfinding">Pathfinding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kicking-kobolds">Kicking kobolds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kicking-kobolds-for-real-this-time">Kicking kobolds, for real this time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#that-s-a-wrap">That’s a wrap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Taking flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">Starting Fights</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">Taking Licks</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">Writing Things Down</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/prism/index.html">Prism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/spectrum/index.html">Spectrum</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../how-tos/inventory.html" title="previous chapter">Inventory</a></li>
      <li>Next: <a href="part2.html" title="next chapter">Taking flight</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Matthew Blanchard, LJNIC.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/making-a-roguelike/part1.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>