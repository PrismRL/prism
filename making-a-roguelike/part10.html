<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<template id="tmpl_gotoTop"><div id="gotoTop">
  <button>Back to top</button>
</div></template>
    <title>Packing your bags &#8212; Prism  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=266695fe" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=fbfae649" />
    <link rel="stylesheet" type="text/css" href="../_static/lua.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/terminal.css?v=76f353a7" />
    <link rel="stylesheet" type="text/css" href="../_static/goto-top/style.css?v=c152bd81" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/goto-top/main.js?v=69fc67a6"></script>
    <link rel="icon" href="../_static/prism.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Having a snack" href="part11.html" />
    <link rel="prev" title="Creating continuity" href="part9.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="packing-your-bags">
<h1>Packing your bags<a class="headerlink" href="#packing-your-bags" title="Link to this heading">¶</a></h1>
<p>In this chapter we’ll implement a simple inventory with the <a class="reference internal" href="../reference/extra/inventory/index.html"><span class="doc">optional module</span></a>.</p>
<p>Head over to main.lua and add the inventory module from extra.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">loadModule</span><span class="p">(</span><span class="s2">&quot;prism/extra/inventory&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="giving-the-player-an-inventory">
<h2>Giving the player an inventory<a class="headerlink" href="#giving-the-player-an-inventory" title="Link to this heading">¶</a></h2>
<p>Let’s head over to <code class="docutils literal notranslate"><span class="pre">modules/game/actors/player.lua</span></code> and add our inventory component.
We’ll limit the size to the alphabet.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Inventory</span><span class="p">{</span>
   <span class="n">limitCount</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
</section>
<section id="adding-a-keybinding">
<h2>Adding a keybinding<a class="headerlink" href="#adding-a-keybinding" title="Link to this heading">¶</a></h2>
<p>Let’s head to <code class="docutils literal notranslate"><span class="pre">keybindingschema.lua</span></code> and add a few entries.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- inventory</span>
<span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;tab&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;inventory&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Opens the inventory screen.&quot;</span> <span class="p">},</span>
<span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;backspace&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;return&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Moves back a level in a substate.&quot;</span> <span class="p">},</span>
<span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;pickup&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Picks up an inventory item.&quot;</span> <span class="p">},</span>
</pre></div>
</div>
<p>We’ll use these later in the tutorial to open the inventory and return to the main
game state.</p>
</section>
<section id="creating-an-inventory-screen">
<h2>Creating an inventory screen<a class="headerlink" href="#creating-an-inventory-screen" title="Link to this heading">¶</a></h2>
<p>Navigate to <code class="docutils literal notranslate"><span class="pre">gamestates</span></code> and create a new file <code class="docutils literal notranslate"><span class="pre">inventorystate.lua</span></code>.</p>
<p>We create a new <a class="reference internal" href="../reference/spectrum/gamestates/meta.html#lua-GameState" title="GameState"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">GameState</span></code></a> and we pass in the display, decision, level,
and the inventory. We get all the items at the time of instantiation and store them in the items field for convenience.
Finally we create a mapping of letters from 1-26 corresponding to a-z which we’ll use during input handling.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">utf8</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;utf8&quot;</span>
<span class="kd">local</span> <span class="n">keybindings</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;keybindingschema&quot;</span>

<span class="c1">--- @class InventoryState : GameState</span>
<span class="c1">--- @overload fun(display: Display, decision: ActionDecision, level: Level, inventory: Inventory)</span>
<span class="kd">local</span> <span class="n">InventoryState</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">.</span><span class="n">GameState</span><span class="p">:</span><span class="n">extend</span> <span class="s2">&quot;InventoryState&quot;</span>

<span class="c1">--- @param display Display</span>
<span class="c1">--- @param decision ActionDecision</span>
<span class="c1">--- @param level Level</span>
<span class="c1">--- @param inventory Inventory</span>
<span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">__new</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">inventory</span><span class="p">)</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">display</span>
   <span class="n">self</span><span class="p">.</span><span class="n">decision</span> <span class="o">=</span> <span class="n">decision</span>
   <span class="n">self</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
   <span class="n">self</span><span class="p">.</span><span class="n">inventory</span> <span class="o">=</span> <span class="n">inventory</span>
   <span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">.</span><span class="n">inventory</span><span class="p">:</span><span class="n">getAllActors</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">letters</span> <span class="o">=</span> <span class="p">{}</span>
   <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="kr">do</span>
      <span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">utf8.char</span><span class="p">(</span><span class="mi">96</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="c1">-- a, b, c, ...</span>
   <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>We also want to keep a reference to the previous <code class="docutils literal notranslate"><span class="pre">GameState</span></code>, so we’ll use <a class="reference internal" href="../reference/spectrum/gamestates/meta.html#lua-GameState.load" title="GameState.load"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">GameState:load()</span></code></a> to capture it.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">load</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span>
   <span class="n">self</span><span class="p">.</span><span class="n">previousState</span> <span class="o">=</span> <span class="n">previous</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Now we’ll draw the inventory. To show the inventory on top of the level, we’ll first draw the previous state.
Then we clear the display and draw a simple header, aligned to the right side of the screen. Finally, we loop through
each item in our inventory, assign it a letter based on its index, and draw it to the screen.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">draw</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">previousState</span><span class="p">:</span><span class="n">draw</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">putString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Inventory&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>

   <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">actor</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>
      <span class="kd">local</span> <span class="n">letter</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Item</span><span class="p">)</span>
      <span class="kd">local</span> <span class="n">countstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
      <span class="kr">if</span> <span class="n">item</span><span class="p">.</span><span class="n">stackCount</span> <span class="ow">and</span> <span class="n">item</span><span class="p">.</span><span class="n">stackCount</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span>
         <span class="n">countstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%sx &quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">stackCount</span><span class="p">)</span>
      <span class="kr">end</span>

      <span class="kd">local</span> <span class="n">itemstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;[%s] %s%s&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">countstr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">putString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">itemstr</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
   <span class="kr">end</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">draw</span><span class="p">()</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Now we handle keypresses. For the items we loop through our letters to find which one matches our keypress
and for now we just try to drop the item when we hit that button. <code class="docutils literal notranslate"><span class="pre">Drop</span></code>’s <a class="reference internal" href="../reference/prism/core/action.html#lua-Action.canPerform" title="Action.canPerform"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">canPerform()</span></code></a> will return false
if given a <code class="docutils literal notranslate"><span class="pre">nil</span></code> target.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">keypressed</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
   <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">)</span> <span class="kr">do</span>
      <span class="kr">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">letter</span> <span class="kr">then</span>
         <span class="kd">local</span> <span class="n">pressedItem</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
         <span class="kd">local</span> <span class="n">drop</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">decision</span><span class="p">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">pressedItem</span><span class="p">)</span>
         <span class="kr">if</span> <span class="n">drop</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">)</span> <span class="kr">then</span>
            <span class="n">self</span><span class="p">.</span><span class="n">decision</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">drop</span><span class="p">)</span>
         <span class="kr">end</span>

         <span class="n">self</span><span class="p">.</span><span class="n">manager</span><span class="p">:</span><span class="n">pop</span><span class="p">()</span>
         <span class="kr">return</span>
      <span class="kr">end</span>
   <span class="kr">end</span>
</pre></div>
</div>
<p>Then we check if the user hit the inventory or return key, and if so we call <a class="reference internal" href="../reference/spectrum/gamestates/statemanager.html#lua-GameStateManager.pop" title="GameStateManager.pop"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">GameStateManager:pop()</span></code></a>,
returning us to the previous state.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span>   <span class="kd">local</span> <span class="n">binding</span> <span class="o">=</span> <span class="n">keybindings</span><span class="p">:</span><span class="n">keypressed</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
   <span class="kr">if</span> <span class="n">binding</span> <span class="o">==</span> <span class="s2">&quot;inventory&quot;</span> <span class="ow">or</span> <span class="n">binding</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span> <span class="kr">then</span>
      <span class="n">self</span><span class="p">.</span><span class="n">manager</span><span class="p">:</span><span class="n">pop</span><span class="p">()</span>
   <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">InventoryState</span>
</pre></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Complete inventorystate.lua</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text"><a class="reference external" href="https://github.com/PrismRL/Kicking-Kobolds/blob/part10/gamestates/inventorystate.lua">Source</a></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">keybindings</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;keybindingschema&quot;</span>

<span class="c1">--- @class InventoryState : GameState</span>
<span class="c1">--- @field previousState GameState</span>
<span class="c1">--- @overload fun(display: Display, decision: ActionDecision, level: Level, inventory: Inventory)</span>
<span class="kd">local</span> <span class="n">InventoryState</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">.</span><span class="n">GameState</span><span class="p">:</span><span class="n">extend</span> <span class="s2">&quot;InventoryState&quot;</span>

<span class="c1">--- @param display Display</span>
<span class="c1">--- @param decision ActionDecision</span>
<span class="c1">--- @param level Level</span>
<span class="c1">--- @param inventory Inventory</span>
<span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">__new</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">inventory</span><span class="p">)</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">display</span>
   <span class="n">self</span><span class="p">.</span><span class="n">decision</span> <span class="o">=</span> <span class="n">decision</span>
   <span class="n">self</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
   <span class="n">self</span><span class="p">.</span><span class="n">inventory</span> <span class="o">=</span> <span class="n">inventory</span>
   <span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">inventory</span><span class="p">.</span><span class="n">inventory</span><span class="p">:</span><span class="n">getAllActors</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">letters</span> <span class="o">=</span> <span class="p">{}</span>
   <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="kr">do</span>
      <span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">string.char</span><span class="p">(</span><span class="mi">96</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="c1">-- a, b, c, ...</span>
   <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">load</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span>
   <span class="n">self</span><span class="p">.</span><span class="n">previousState</span> <span class="o">=</span> <span class="n">previous</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">draw</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">previousState</span><span class="p">:</span><span class="n">draw</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">clear</span><span class="p">()</span>
   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">putString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Inventory&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>

   <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">actor</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">getName</span><span class="p">()</span>
      <span class="kd">local</span> <span class="n">letter</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">actor</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Item</span><span class="p">)</span>
      <span class="kd">local</span> <span class="n">countstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
      <span class="kr">if</span> <span class="n">item</span><span class="p">.</span><span class="n">stackCount</span> <span class="ow">and</span> <span class="n">item</span><span class="p">.</span><span class="n">stackCount</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span> <span class="n">countstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%sx &quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">stackCount</span><span class="p">)</span> <span class="kr">end</span>

      <span class="kd">local</span> <span class="n">itemstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;[%s] %s%s&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">countstr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">putString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">itemstr</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
   <span class="kr">end</span>

   <span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">:</span><span class="n">draw</span><span class="p">()</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">InventoryState</span><span class="p">:</span><span class="nf">keypressed</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
   <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">letters</span><span class="p">)</span> <span class="kr">do</span>
      <span class="kr">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">letter</span> <span class="kr">then</span>
         <span class="kd">local</span> <span class="n">pressedItem</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
         <span class="kd">local</span> <span class="n">drop</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Drop</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">decision</span><span class="p">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">pressedItem</span><span class="p">)</span>
         <span class="kr">if</span> <span class="n">drop</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">)</span> <span class="kr">then</span> <span class="n">self</span><span class="p">.</span><span class="n">decision</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">drop</span><span class="p">)</span> <span class="kr">end</span>

         <span class="n">self</span><span class="p">.</span><span class="n">manager</span><span class="p">:</span><span class="n">pop</span><span class="p">()</span>
         <span class="kr">return</span>
      <span class="kr">end</span>
   <span class="kr">end</span>

   <span class="kd">local</span> <span class="n">binding</span> <span class="o">=</span> <span class="n">keybindings</span><span class="p">:</span><span class="n">keypressed</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
   <span class="kr">if</span> <span class="n">binding</span> <span class="o">==</span> <span class="s2">&quot;inventory&quot;</span> <span class="ow">or</span> <span class="n">binding</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span> <span class="kr">then</span> <span class="n">self</span><span class="p">.</span><span class="n">manager</span><span class="p">:</span><span class="n">pop</span><span class="p">()</span> <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">InventoryState</span>
</pre></div>
</div>
</div>
</details></section>
<section id="opening-the-inventory">
<h2>Opening the inventory<a class="headerlink" href="#opening-the-inventory" title="Link to this heading">¶</a></h2>
<p>With the inventory state complete it’s time to glue things together. Head back to <code class="docutils literal notranslate"><span class="pre">gamelevelstate.lua</span></code> and
let’s add some input handling to get the <code class="docutils literal notranslate"><span class="pre">InventoryState</span></code> to pop up.</p>
<p>First <a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#pdf-require"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">require</span></code></a> access our <code class="docutils literal notranslate"><span class="pre">InventoryState</span></code> at the top of the file.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">InventoryState</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;gamestates.inventorystate&quot;</span>
</pre></div>
</div>
<p>Then at the bottom of <code class="docutils literal notranslate"><span class="pre">GameLevelState:keypressed</span></code>, just above the wait action, we’ll check for the inventory key
and push the <code class="docutils literal notranslate"><span class="pre">InventoryState</span></code>, if the current actor (<code class="docutils literal notranslate"><span class="pre">owner</span></code>) has an inventory.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">MyGameLevelState</span><span class="p">:</span><span class="nf">keypressed</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">)</span>
   <span class="c1">-- ...</span>

   <span class="kr">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;inventory&quot;</span> <span class="kr">then</span>
      <span class="kd">local</span> <span class="n">inventory</span> <span class="o">=</span> <span class="n">owner</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Inventory</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">inventory</span> <span class="kr">then</span>
         <span class="kd">local</span> <span class="n">inventoryState</span> <span class="o">=</span> <span class="n">InventoryState</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">,</span> <span class="n">inventory</span><span class="p">)</span>
         <span class="n">self</span><span class="p">.</span><span class="n">manager</span><span class="p">:</span><span class="n">push</span><span class="p">(</span><span class="n">inventoryState</span><span class="p">)</span>
      <span class="kr">end</span>
   <span class="kr">end</span>

   <span class="c1">-- Handle waiting</span>
   <span class="kr">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;wait&quot;</span> <span class="kr">then</span> <span class="n">decision</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">decision</span><span class="p">.</span><span class="n">actor</span><span class="p">))</span> <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Now we can run the game and hit tab. The inventory menu will show up (but won’t do anything)!</p>
</section>
<section id="creating-an-item">
<h2>Creating an item<a class="headerlink" href="#creating-an-item" title="Link to this heading">¶</a></h2>
<p>Our kobold kicking hero needs something to chew on, and a way to regain health! Let’s add a Meat Brick that they
can pick up and eat to restore their health.</p>
<p>Create a new file in <code class="docutils literal notranslate"><span class="pre">modules/game/actors</span></code> called <code class="docutils literal notranslate"><span class="pre">meatbrick.lua</span></code> and register the following actor.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">registerActor</span><span class="p">(</span><span class="s2">&quot;MeatBrick&quot;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">Actor</span><span class="p">.</span><span class="n">fromComponents</span><span class="p">{</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;Meat Brick&quot;</span><span class="p">),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Position</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">RED</span><span class="p">),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Item</span><span class="p">{</span>
         <span class="n">stackable</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actors</span><span class="p">.</span><span class="n">MeatBrick</span><span class="p">,</span>
         <span class="n">stackLimit</span> <span class="o">=</span> <span class="mi">99</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>We give it the <a class="reference internal" href="../reference/extra/inventory/components/item.html#lua-Item" title="Item"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Item</span></code></a> component to indicate it can be held in an <a class="reference internal" href="../reference/extra/inventory/components/inventory.html#lua-Inventory" title="Inventory"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Inventory</span></code></a>.
We’ll make it consumable in the next chapter!</p>
</section>
<section id="picking-things-up">
<h2>Picking things up<a class="headerlink" href="#picking-things-up" title="Link to this heading">¶</a></h2>
<p>Now to be able to pick these things up we’ll need to hook up the <a class="reference internal" href="../reference/extra/inventory/actions/pickup.html#lua-Pickup" title="Pickup"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Pickup</span></code></a> action.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;pickup&quot;</span> <span class="kr">then</span>
   <span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Item</span><span class="p">)</span>
      <span class="p">:</span><span class="n">at</span><span class="p">(</span><span class="n">owner</span><span class="p">:</span><span class="n">getPosition</span><span class="p">():</span><span class="n">decompose</span><span class="p">())</span>
      <span class="p">:</span><span class="n">first</span><span class="p">()</span>

   <span class="kd">local</span> <span class="n">pickup</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Pickup</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
   <span class="kr">if</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span><span class="p">:</span><span class="n">canPerform</span><span class="p">(</span><span class="n">pickup</span><span class="p">)</span> <span class="kr">then</span>
      <span class="n">decision</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">pickup</span><span class="p">)</span>
      <span class="kr">return</span>
   <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>We grab the first item on the tile and use it as the target for <code class="docutils literal notranslate"><span class="pre">Pickup</span></code>.
Boot up the game and draw in a few meat bricks with Geometer. You should be able to
pick up and drop them now!</p>
</section>
<section id="fixing-the-draw-order">
<h2>Fixing the draw order<a class="headerlink" href="#fixing-the-draw-order" title="Link to this heading">¶</a></h2>
<p>You might notice that now when the player moves on top of the food sometimes the player is drawn underneath the food.
We can fix this by changing the depth or ‘layer’ the player’s drawable is drawn at.
Go ahead and navigate back to <code class="docutils literal notranslate"><span class="pre">modules/game/actors/player.lua</span></code>
and change the following line from</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">GREEN</span><span class="p">),</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">GREEN</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nb">math.huge</span><span class="p">),</span>
</pre></div>
</div>
<p>We’re setting the background color to <code class="docutils literal notranslate"><span class="pre">nil</span></code> so that it still defaults to transparent, but we’re setting our draw priority
to <a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#pdf-math.huge"><code class="xref lua lua-data docutils literal notranslate"><span class="pre">math.huge</span></code></a> so the player will always draw on top of everything else.</p>
</section>
<section id="in-the-next-chapter">
<h2>In the next chapter<a class="headerlink" href="#in-the-next-chapter" title="Link to this heading">¶</a></h2>
<p>We’ve implemented a simple inventory with the provided inventory module.
In the next chapter we’ll make the bricks consumable, get them to drop from kobolds, and add
user interface elements to allow the user a choice between dropping and eating the meat.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/prism.png" alt="Logo" />
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=prismrl&repo=prism&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<!--
Taken from the sphinx library theme: https://vsalvino.github.io/sphinx-library/.

MIT License

Copyright (c) 2020 Vince Salvino and contributors.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<script>
  function toggleMode(theme) {
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("sphinx-terminal-mode", theme);
  }
  var theme = localStorage.getItem("sphinx-terminal-mode");
  if(theme !== null)
    toggleMode(theme);
</script>
<h3>Reading Mode</h3>

<div class="btn-group">
<button class="btn btn-default" type="button" onclick="toggleMode('light');">Light</button>
<button class="btn btn-default" type="button" onclick="toggleMode('sepia');">Sepia</button>
<button class="btn btn-default" type="button" onclick="toggleMode('dark');">Dark</button>
</div>

<noscript>
  <div>
    JavaScript is required to toggle reading modes.
  </div>
</noscript>
<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture-primer.html">Architecture primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-tos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/object-registration.html">Object registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/query.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/collision.html">Collision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/targets.html">Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Making a roguelike</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part1.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Taking flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">Starting fights</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">Taking licks</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">Writing things down</a></li>
<li class="toctree-l1"><a class="reference internal" href="part6.html">Losing the game</a></li>
<li class="toctree-l1"><a class="reference internal" href="part7.html">Carving out caverns</a></li>
<li class="toctree-l1"><a class="reference internal" href="part8.html">Descending into the depths</a></li>
<li class="toctree-l1"><a class="reference internal" href="part9.html">Creating continuity</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Packing your bags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#giving-the-player-an-inventory">Giving the player an inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-keybinding">Adding a keybinding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-inventory-screen">Creating an inventory screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#opening-the-inventory">Opening the inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-item">Creating an item</a></li>
<li class="toctree-l2"><a class="reference internal" href="#picking-things-up">Picking things up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fixing-the-draw-order">Fixing the draw order</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-the-next-chapter">In the next chapter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part11.html">Having a snack</a></li>
<li class="toctree-l1"><a class="reference internal" href="part12.html">Stashing treasure</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explainers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explainers/game-loop.html">The game loop</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/prism/index.html">Prism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/spectrum/index.html">Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/extra/index.html">Extra</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="part9.html" title="previous chapter">Creating continuity</a></li>
      <li>Next: <a href="part11.html" title="next chapter">Having a snack</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Matthew Blanchard, LJNIC.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/making-a-roguelike/part10.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>