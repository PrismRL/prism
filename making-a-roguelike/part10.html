<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<template id="tmpl_gotoTop"><div id="gotoTop">
  <button>Back to top</button>
</div></template>
    <title>Stashing treasure &#8212; Prism  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=266695fe" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=fbfae649" />
    <link rel="stylesheet" type="text/css" href="../_static/lua.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/terminal.css?v=c90e5a8a" />
    <link rel="stylesheet" type="text/css" href="../_static/goto-top/style.css?v=c152bd81" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/goto-top/main.js?v=69fc67a6"></script>
    <link rel="icon" href="../_static/prism.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Packing your bags" href="part11.html" />
    <link rel="prev" title="Creating continuity" href="part9.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="stashing-treasure">
<h1>Stashing treasure<a class="headerlink" href="#stashing-treasure" title="Link to this heading">¶</a></h1>
<p>In this chapter we’ll use the optional <a class="reference internal" href="../reference/extra/droptable/components/droptable.html#lua-DropTable" title="DropTable"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">DropTable</span></code></a> component to implement chests and have
kobolds drop items.</p>
<section id="creating-an-item">
<h2>Creating an item<a class="headerlink" href="#creating-an-item" title="Link to this heading">¶</a></h2>
<p>Our kobold kicking hero needs something to chew on, and a way to regain health! Let’s add a Meat
Brick that they can pick up and eat to restore their health.</p>
<p>First, register the inventory module in <code class="docutils literal notranslate"><span class="pre">main.lua</span></code>. While we’re here, register the drop table
module as well.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">loadModule</span><span class="p">(</span><span class="s2">&quot;prism/extra/inventory&quot;</span><span class="p">)</span>
<span class="n">prism</span><span class="p">.</span><span class="n">loadModule</span><span class="p">(</span><span class="s2">&quot;prism/extra/droptable&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then create a new file in <code class="docutils literal notranslate"><span class="pre">modules/game/actors</span></code> called <code class="docutils literal notranslate"><span class="pre">meatbrick.lua</span></code> and register the
following actor.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">registerActor</span><span class="p">(</span><span class="s2">&quot;MeatBrick&quot;</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">Actor</span><span class="p">.</span><span class="n">fromComponents</span><span class="p">{</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;Meat Brick&quot;</span><span class="p">),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Position</span><span class="p">(),</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span> <span class="p">{</span> <span class="n">index</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">RED</span> <span class="p">},</span>
      <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Item</span><span class="p">{</span>
         <span class="n">stackable</span> <span class="o">=</span> <span class="s2">&quot;MeatBrick&quot;</span><span class="p">,</span>
         <span class="n">stackLimit</span> <span class="o">=</span> <span class="mi">99</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>We give it the <a class="reference internal" href="../reference/extra/inventory/components/item.html#lua-Item" title="Item"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Item</span></code></a> component to indicate it can be held in an <a class="reference internal" href="../reference/extra/inventory/components/inventory.html#lua-Inventory" title="Inventory"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">Inventory</span></code></a>.
We’ll make it consumable in a future chapter!</p>
</section>
<section id="getting-the-drop-on-it">
<h2>Getting the drop on it<a class="headerlink" href="#getting-the-drop-on-it" title="Link to this heading">¶</a></h2>
<p>Now we can give <code class="docutils literal notranslate"><span class="pre">modules/game/actors/kobold.lua</span></code> a <code class="docutils literal notranslate"><span class="pre">DropTable</span></code>. We’ll give them a 30% chance to
drop one of our meat bricks.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">DropTable</span> <span class="p">{</span>
   <span class="n">chance</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
   <span class="n">entry</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actors</span><span class="p">.</span><span class="n">MeatBrick</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you were to kick a few kobolds you’d notice nothing is happening! That’s because the drop table
needs to be hooked into the game logic. Open <code class="docutils literal notranslate"><span class="pre">modules/game/actions/die.lua</span></code> and we’ll add drops to
the level when an actor dies.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">Die</span><span class="p">:</span><span class="nf">perform</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">:</span><span class="n">getPosition</span><span class="p">():</span><span class="n">decompose</span><span class="p">()</span>
   <span class="kd">local</span> <span class="n">dropTable</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">DropTable</span><span class="p">)</span>

   <span class="kr">if</span> <span class="n">dropTable</span> <span class="kr">then</span>
      <span class="kd">local</span> <span class="n">drops</span> <span class="o">=</span> <span class="n">dropTable</span><span class="p">:</span><span class="n">getDrops</span><span class="p">(</span><span class="n">level</span><span class="p">.</span><span class="n">rng</span><span class="p">)</span>
      <span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">drop</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">drops</span><span class="p">)</span> <span class="kr">do</span>
         <span class="n">level</span><span class="p">:</span><span class="n">addActor</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="kr">end</span>
   <span class="kr">end</span>

   <span class="c1">-- rest of Die:perform</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>If they have a drop table, we use <a class="reference internal" href="../reference/extra/droptable/components/droptable.html#lua-DropTable.getDrops" title="DropTable.getDrops"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">DropTable:getDrops()</span></code></a> to roll the drop table, and add
each item to the level at the actor’s position.</p>
<p>To ensure dropped items don’t float over pits, we can add the <a class="reference internal" href="../reference/prism/core/system.html#lua-System.onActorAdded" title="System.onActorAdded"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">System:onActorAdded()</span></code></a>
callback to <code class="docutils literal notranslate"><span class="pre">modules/game/systems/fallsystem.lua</span></code>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">FallSystem</span><span class="p">:</span><span class="nf">onActorAdded</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>
   <span class="n">level</span><span class="p">:</span><span class="n">tryPerform</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">Fall</span><span class="p">(</span><span class="n">actor</span><span class="p">))</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Boot up the game and kick a few kobolds around. They should start dropping meat!</p>
</section>
<section id="creating-containers">
<h2>Creating containers<a class="headerlink" href="#creating-containers" title="Link to this heading">¶</a></h2>
<p>For chests, we’ll start with a new tag. Navigate <code class="docutils literal notranslate"><span class="pre">modules/game/components</span></code> and create a new file
there called <code class="docutils literal notranslate"><span class="pre">container.lua</span></code>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--- </span><span class="k k-Comment">@class</span><span class="cm"> Container : Component</span>
<span class="cm">--- </span><span class="k k-Comment">@overload</span><span class="cm"> fun(): Container</span>
<span class="kd">local</span> <span class="n">Container</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Component</span><span class="p">:</span><span class="n">extend</span> <span class="s2">&quot;Container&quot;</span>

<span class="kr">function</span> <span class="nc">Container</span><span class="p">:</span><span class="nf">getRequirements</span><span class="p">()</span>
   <span class="kr">return</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Inventory</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">Container</span>
</pre></div>
</div>
<p>Next we’ll define a new action for opening these. Head over to <code class="docutils literal notranslate"><span class="pre">modules/game/actions</span></code> and create a
new file called <code class="docutils literal notranslate"><span class="pre">opencontainer.lua</span></code>. For our target, we want a container within range 1 that we
can see.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">Name</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Name</span>
<span class="kd">local</span> <span class="n">Log</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Log</span>

<span class="kd">local</span> <span class="n">OpenContainerTarget</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Target</span><span class="p">()</span>
   <span class="p">:</span><span class="n">with</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Container</span><span class="p">)</span>
   <span class="p">:</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="p">:</span><span class="n">sensed</span><span class="p">()</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">perform</span></code>, we grab every item in the target container’s inventory and dump them on the ground,
before removing the container and logging messages.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--- </span><span class="k k-Comment">@class</span><span class="cm"> OpenContainer : Action</span>
<span class="kd">local</span> <span class="n">OpenContainer</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Action</span><span class="p">:</span><span class="n">extend</span> <span class="s2">&quot;OpenContainer&quot;</span>
<span class="n">OpenContainer</span><span class="p">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">{</span> <span class="n">OpenContainerTarget</span> <span class="p">}</span>
<span class="n">OpenContainer</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Open&quot;</span>

<span class="cm">--- </span><span class="k k-Comment">@param</span><span class="cm"> level Level</span>
<span class="cm">--- </span><span class="k k-Comment">@param</span><span class="cm"> container Actor</span>
<span class="kr">function</span> <span class="nc">OpenContainer</span><span class="p">:</span><span class="nf">perform</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">inventory</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">expect</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Inventory</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">container</span><span class="p">:</span><span class="n">expectPosition</span><span class="p">():</span><span class="n">decompose</span><span class="p">()</span>

   <span class="n">inventory</span><span class="p">:</span><span class="n">query</span><span class="p">():</span><span class="n">each</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="n">inventory</span><span class="p">:</span><span class="n">removeItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
      <span class="n">level</span><span class="p">:</span><span class="n">addActor</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
   <span class="kr">end</span><span class="p">)</span>

   <span class="n">level</span><span class="p">:</span><span class="n">removeActor</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

   <span class="kd">local</span> <span class="n">containerName</span> <span class="o">=</span> <span class="n">Name</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
   <span class="n">Log</span><span class="p">.</span><span class="n">addMessage</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">,</span> <span class="s2">&quot;You kick open the %s.&quot;</span><span class="p">,</span> <span class="n">containerName</span><span class="p">)</span>
   <span class="n">Log</span><span class="p">.</span><span class="n">addMessageSensed</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">self</span><span class="p">,</span> <span class="s2">&quot;The %s kicks open the %s.&quot;</span><span class="p">,</span> <span class="n">Name</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">owner</span><span class="p">),</span> <span class="n">containerName</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">OpenContainer</span>
</pre></div>
</div>
<p>Now that we’re all set up with our container logic we need to actually make a container to try this
with. Let’s create a new file in <code class="docutils literal notranslate"><span class="pre">modules/game/actors</span></code> called <code class="docutils literal notranslate"><span class="pre">chest.lua</span></code>. We’ll accept a
<code class="docutils literal notranslate"><span class="pre">contents</span></code> parameter to define the items in the chest and use <a class="reference internal" href="../reference/extra/inventory/components/inventory.html#lua-Inventory.addItems" title="Inventory.addItems"><code class="xref lua lua-func docutils literal notranslate"><span class="pre">Inventory:addItems()</span></code></a>.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">prism</span><span class="p">.</span><span class="n">registerActor</span><span class="p">(</span><span class="s2">&quot;Chest&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">inventory</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Inventory</span><span class="p">()</span>
   <span class="kd">local</span> <span class="n">chest</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">Actor</span><span class="p">.</span><span class="n">fromComponents</span> <span class="p">{</span>
       <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;Chest&quot;</span><span class="p">),</span>
       <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Position</span><span class="p">(),</span>
       <span class="n">inventory</span><span class="p">,</span>
       <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Drawable</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">prism</span><span class="p">.</span><span class="n">Color4</span><span class="p">.</span><span class="n">YELLOW</span><span class="p">),</span>
       <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Container</span><span class="p">(),</span>
       <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Collider</span><span class="p">()</span>
   <span class="p">}</span>
   <span class="cm">--- </span><span class="k k-Comment">@cast</span><span class="cm"> contents Actor[]</span>
   <span class="n">inventory</span><span class="p">:</span><span class="n">addItems</span><span class="p">(</span><span class="n">contents</span> <span class="ow">or</span> <span class="p">{})</span>
   <span class="kr">return</span> <span class="n">chest</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To support Geometer, parameters passed to actor and cell factories must be optional.</p>
</div>
</section>
<section id="cracking-a-cold-one">
<h2>Cracking a cold one<a class="headerlink" href="#cracking-a-cold-one" title="Link to this heading">¶</a></h2>
<p>If you launch the game and bump into a chest you’ll notice you kick it, which is fun but not exactly
what we want. We’ll have to change to logic in <code class="docutils literal notranslate"><span class="pre">GameLevelState</span></code>. In
<code class="docutils literal notranslate"><span class="pre">GameLevelState:updateDecision</span></code> add the following right above where we try to kick:</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nc">GameLevelState</span><span class="p">:</span><span class="nf">updateDecision</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">decision</span><span class="p">)</span>
   <span class="c1">-- yada yada</span>
   <span class="kr">if</span> <span class="n">controls</span><span class="p">.</span><span class="n">move</span><span class="p">.</span><span class="n">pressed</span> <span class="kr">then</span>
      <span class="c1">-- blah blah</span>

      <span class="kd">local</span> <span class="n">openable</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">level</span>
         <span class="p">:</span><span class="n">query</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">Container</span><span class="p">)</span>
         <span class="p">:</span><span class="n">at</span><span class="p">(</span><span class="n">destination</span><span class="p">:</span><span class="n">decompose</span><span class="p">())</span>
         <span class="p">:</span><span class="n">first</span><span class="p">()</span>

      <span class="kd">local</span> <span class="n">openContainer</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">actions</span><span class="p">.</span><span class="n">OpenContainer</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">openable</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">self</span><span class="p">:</span><span class="n">setAction</span><span class="p">(</span><span class="n">openContainer</span><span class="p">)</span> <span class="kr">then</span> <span class="kr">return</span> <span class="kr">end</span>

      <span class="c1">-- kick stuff</span>
   <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Okay! When you walk into a chest now you should pop that sucker open! Congratulations! Wait, nothing
was inside the chest though. That’s not very fun. Let’s take care of that.</p>
</section>
<section id="spicing-up-level-generation">
<h2>Spicing up level generation<a class="headerlink" href="#spicing-up-level-generation" title="Link to this heading">¶</a></h2>
<p>Let’s first create a new top level folder, <code class="docutils literal notranslate"><span class="pre">loot</span></code> and within that folder a new file <code class="docutils literal notranslate"><span class="pre">chest.lua</span></code>.
Let’s keep it simple for now and give chests a guaranteed drop of meat.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="cm">--- </span><span class="k k-Comment">@type</span><span class="cm"> DropTableOptions</span>
<span class="kr">return</span> <span class="p">{</span>
   <span class="p">{</span>
      <span class="n">entry</span> <span class="o">=</span> <span class="s2">&quot;MeatBrick&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At the end of <code class="docutils literal notranslate"><span class="pre">levelgen.lua</span></code>, we’ll spawn a chest in the middle of a random room.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">chestRoom</span> <span class="o">=</span> <span class="n">availableRooms</span><span class="p">[</span><span class="n">rng</span><span class="p">:</span><span class="n">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">availableRooms</span><span class="p">)]</span>
<span class="kd">local</span> <span class="n">center</span> <span class="o">=</span> <span class="n">chestRoom</span><span class="p">:</span><span class="n">center</span><span class="p">():</span><span class="n">floor</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">drops</span> <span class="o">=</span> <span class="n">prism</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">DropTable</span><span class="p">(</span><span class="n">chestloot</span><span class="p">):</span><span class="n">getDrops</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

<span class="n">builder</span><span class="p">:</span><span class="n">addActor</span><span class="p">(</span><span class="n">prism</span><span class="p">.</span><span class="n">actors</span><span class="p">.</span><span class="n">Chest</span><span class="p">(</span><span class="n">drops</span><span class="p">),</span> <span class="n">center</span><span class="p">:</span><span class="n">decompose</span><span class="p">())</span>

<span class="kr">return</span> <span class="n">builder</span>
</pre></div>
</div>
<p>The chest will overlap with a kobold, but we’ll deal with that when we revisit level generation.
You’ll see now that when we open the chest we get a meat brick!</p>
</section>
<section id="in-the-next-chapter">
<h2>In the next chapter<a class="headerlink" href="#in-the-next-chapter" title="Link to this heading">¶</a></h2>
<p>We’ve used the <a class="reference internal" href="../reference/extra/droptable/components/droptable.html#lua-DropTable" title="DropTable"><code class="xref lua lua-class docutils literal notranslate"><span class="pre">DropTable</span></code></a> component to add drops to kobolds and added chests. In the
<a class="reference internal" href="part11.html"><span class="doc">next chapter</span></a> we’ll start on an inventory system.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/prism.png" alt="Logo" />
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=prismrl&repo=prism&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<!--
Taken from the sphinx library theme: https://vsalvino.github.io/sphinx-library/.

MIT License

Copyright (c) 2020 Vince Salvino and contributors.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<script>
  function toggleMode(theme) {
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("sphinx-terminal-mode", theme);
  }
  var theme = localStorage.getItem("sphinx-terminal-mode");
  if(theme !== null)
    toggleMode(theme);
</script>
<h3>Reading Mode</h3>

<div class="btn-group">
<button class="btn btn-default" type="button" onclick="toggleMode('light');">Light</button>
<button class="btn btn-default" type="button" onclick="toggleMode('sepia');">Sepia</button>
<button class="btn btn-default" type="button" onclick="toggleMode('dark');">Dark</button>
</div>

<noscript>
  <div>
    JavaScript is required to toggle reading modes.
  </div>
</noscript>
<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture-primer.html">Architecture primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-tos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/object-registration.html">Object registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/query.html">Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/animation.html">Animation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/collision.html">Collision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/controls.html">Input handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/spriteatlas.html">Sprites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-tos/targets.html">Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Making a roguelike</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part1.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">Taking flight</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3.html">Starting fights</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">Taking licks</a></li>
<li class="toctree-l1"><a class="reference internal" href="part5.html">Writing things down</a></li>
<li class="toctree-l1"><a class="reference internal" href="part6.html">Losing the game</a></li>
<li class="toctree-l1"><a class="reference internal" href="part7.html">Carving out caverns</a></li>
<li class="toctree-l1"><a class="reference internal" href="part8.html">Descending into the depths</a></li>
<li class="toctree-l1"><a class="reference internal" href="part9.html">Creating continuity</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stashing treasure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-item">Creating an item</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-the-drop-on-it">Getting the drop on it</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-containers">Creating containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cracking-a-cold-one">Cracking a cold one</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spicing-up-level-generation">Spicing up level generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-the-next-chapter">In the next chapter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part11.html">Packing your bags</a></li>
<li class="toctree-l1"><a class="reference internal" href="part12.html">Having a snack</a></li>
<li class="toctree-l1"><a class="reference internal" href="part13.html">Brewing potions</a></li>
<li class="toctree-l1"><a class="reference internal" href="part14.html">Zapping wands</a></li>
<li class="toctree-l1"><a class="reference internal" href="part15.html">Gearing up</a></li>
<li class="toctree-l1"><a class="reference internal" href="part16.html">Saving the game</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explainers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explainers/game-loop.html">The game loop</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/prism/index.html">Prism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/spectrum/index.html">Spectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/extra/index.html">Extra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/geometer/index.html">Geometer</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="part9.html" title="previous chapter">Creating continuity</a></li>
      <li>Next: <a href="part11.html" title="next chapter">Packing your bags</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Matthew Blanchard, LJNIC.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/making-a-roguelike/part10.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>